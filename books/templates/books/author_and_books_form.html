{% extends "base.html" %}

{% load bootstrap %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Add{% endif %} Author and Books{% endblock title %}

{% block bottom_script %}{{ block.super }}
    <script src="{{ STATIC_URL }}js/underscore/underscore.min.js" ></script>
    <script type="text/html" id="book-template">
    <div id="book-<%= id %>">
        <label for="id_books-<%= id %>-title">Book Title:</label>
        <input id="id_books-<%= id %>-title" type="text" name="books-<%= id %>-title" maxlength="100">
        <input type="hidden" name="books-<%= id %>-author" id="id_books-<%= id %>-author">
        <input type="hidden" name="books-<%= id %>-id" id="id_books-<%= id %>-id">
    </div>
    </script>
    <script>
    $(function() {
        $('.add-book').click(function(ev){
            ev.preventDefault();
            var count = $('.books').children().length;
            var tmplMarkup = $('#book-template').html();
            var compiledTmpl = _.template(tmplMarkup, { id : count });
            $('div.books').append(compiledTmpl);
            // update form count
            $('#id_books-TOTAL_FORMS').attr('value', count+1);
        });
    });
    </script>{% endblock bottom_script %}


{% block base_content %}

<div class="page-header">
  <h1>{% if form.instance.pk %}Edit{% else %}Add{% endif %} Author and Books</h1>
</div>

<form action="." method="post">
  {% csrf_token %}

  <legend>Author</legend>
  {{ form|bootstrap }}

  {{ formset.management_form }}

  <legend>Books</legend>
  <div class="books form-inline">
    {% for book_form in formset %}
      <div id="book-{{ forloop.counter0 }}">
        {{ book_form }}
      </div>
    {% endfor %}
  </div>
  <div class="form-actions">
     <a href="#" class="btn btn-inverse add-book">Add Book</a>
     <button type="submit" class="btn btn-primary">{% if form.instance.pk %}<i class="icon-edit icon-white"></i> Save{% else %}<i class="icon-plus icon-white"></i> Add{% endif %} Author and Books</button>
   </div>
 </form>

{% endblock base_content %}